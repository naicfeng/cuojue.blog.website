<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/favicon.ico"><link rel="icon" href="/favicon.ico"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#2f4154"><meta name="author" content="WeiCN"><meta name="keywords" content="weicn,æ˜¥é£å¹,WeiCNçš„åšå®¢,æµ…ç§‹æ«å½±,æ­¦é˜³ç ´æ™“çš„åšå®¢,æµ…ç§‹æ«å½±çš„åšå®¢"><meta name="description" content="OneIndex-CF-Indexæ˜¯ç”± CloudFlare Workers å¼ºåŠ›é©±åŠ¨çš„ OneDrive ç´¢å¼•ï¼Œæœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æŠ„è‡ªå®˜æ–¹æ–‡æ¡£ï¼Œä½†æ˜¯è¡¥å……äº†äº²è‡ªéƒ¨ç½²æ—¶å€™é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•."><meta property="og:type" content="article"><meta property="og:title" content="ç”¨Cloudflare Workersæ­å»ºå…è´¹OneDriveç½‘ç›˜"><meta property="og:url" content="https://cuojue.org/read/Cloudflare-Workers-OneDrive.html"><meta property="og:site_name" content="æ˜¥é£å¹ - æµ…ç§‹æ«å½±çš„åšå®¢"><meta property="og:description" content="OneIndex-CF-Indexæ˜¯ç”± CloudFlare Workers å¼ºåŠ›é©±åŠ¨çš„ OneDrive ç´¢å¼•ï¼Œæœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æŠ„è‡ªå®˜æ–¹æ–‡æ¡£ï¼Œä½†æ˜¯è¡¥å……äº†äº²è‡ªéƒ¨ç½²æ—¶å€™é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-1.jpg"><meta property="article:published_time" content="2021-03-08T17:00:00.000Z"><meta property="article:modified_time" content="2022-03-13T11:20:00.000Z"><meta property="article:author" content="WeiCN"><meta property="article:tag" content="Cloudflare"><meta property="article:tag" content="Workers"><meta property="article:tag" content="OneDrive"><meta property="article:tag" content="OneIndex-CF-Index"><meta property="article:tag" content="OneIndex"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-1.jpg"><title>ç”¨Cloudflare Workersæ­å»ºå…è´¹OneDriveç½‘ç›˜ - æ˜¥é£å¹ - æµ…ç§‹æ«å½±çš„åšå®¢</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="https://npm.elemecdn.com/nacdn@1.0.31/css/main.css"><link id="highlight-css" rel="stylesheet" href="https://npm.elemecdn.com/nacdn@1.0.31/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="https://npm.elemecdn.com/nacdn@1.0.31/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"cuojue.org",root:"/",version:"1.0.0",typing:{enable:!0,typeSpeed:50,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg",onlypost:!1,offset_factor:2},web_analytics:{enable:!0,baidu:"c987613129741480f7d9ce1f782ca4f3",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/xml/local-search.xml"}</script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/utils.js"></script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.1"></head><body><header><div class="header-inner" style="height:40vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>æµ…ç§‹æ«å½±</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> é¦–é¡µ</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> å½’æ¡£</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> åˆ†ç±»</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> æ ‡ç­¾</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-user-fill"></i> å…³äº</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/about/">About Me </a><a class="dropdown-item" target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9zdGF0dXMuY3VvanVlLm9yZw==" rel="noopener external nofollow noreferrer">Server Status </a><a class="dropdown-item" target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly93dXlhbmcud3M=" rel="noopener external nofollow noreferrer">WuYang's Drive</a></div></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> å‹é“¾</a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-2.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="ç”¨Cloudflare Workersæ­å»ºå…è´¹OneDriveç½‘ç›˜"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> WeiCN </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2021-03-09 01:00" pubdate><time datetime="2022-03-13 19:20" update></time> 2021å¹´3æœˆ9æ—¥ å‡Œæ™¨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i>6.5k å­— </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i>21 åˆ†é’Ÿ</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">ç”¨Cloudflare Workersæ­å»ºå…è´¹OneDriveç½‘ç›˜</h1><div class="markdown-body"><h2 id="ç”±-CloudFlare-Workers-å¼ºåŠ›é©±åŠ¨çš„-OneDrive-ç´¢å¼•"><a href="#ç”±-CloudFlare-Workers-å¼ºåŠ›é©±åŠ¨çš„-OneDrive-ç´¢å¼•" class="headerlink" title="ç”± CloudFlare Workers å¼ºåŠ›é©±åŠ¨çš„ OneDrive ç´¢å¼•"></a>ç”± CloudFlare Workers å¼ºåŠ›é©±åŠ¨çš„ OneDrive ç´¢å¼•</h2><p>åœ¨çº¿æ¼”ç¤ºï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9vbmUuY3VvanVlLndvcmtlcnMuZGV2Lw==" rel="noopener external nofollow noreferrer">WuYangâ€™s Disk</a></p><blockquote><p>æ¼”ç¤ºè¿˜æ˜¯æˆ‘é‚£30å¤šGçš„å¦¹å­å›¾â€¦â€¦<br><a href="/read/106.html">å…±äº«ä¸€æ³¢å¦¹å­å›¾</a><br>ç”±äºå›Šä¸­ç¾æ¶©æ²¡æœ‰ç»§ç»­éƒ¨ç½² PHP ç‰ˆæœ¬çš„ OneIndex äº†.<br>æ¢ç”¨ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3NwZW5jZXJ3b29vL29uZWRyaXZlLWNmLWluZGV4" rel="noopener external nofollow noreferrer">OneIndex-CF-Index</a> åå¯ä»¥è·å¾— <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly93b3JrZXJzLmNsb3VkZmxhcmUuY29tLw==" rel="noopener external nofollow noreferrer">Cloudflare-Workers</a> æ¯æ—¥ 1W PVçš„å…è´¹è¯·æ±‚.</p></blockquote><hr><blockquote><p>2022-03-13 æ›´æ–° ç¨‹åºå·²æ¢åˆ°æ›´å¼ºå¤§çš„ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3NwZW5jZXJ3b29vL29uZWRyaXZlLXZlcmNlbC1pbmRleA==" rel="noopener external nofollow noreferrer">OneIndex-Vercel-Index</a><br>ä¾‹ï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9vbmUuY3VvanVlLm9yZy8=" rel="noopener external nofollow noreferrer">WuYangâ€™s Disk</a></p></blockquote><hr><blockquote><p>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹æŠ„è‡ªå®˜æ–¹æ–‡æ¡£ï¼Œä½†æ˜¯è¡¥å……äº†äº²è‡ªéƒ¨ç½²æ—¶å€™é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ³•.</p></blockquote><h2 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h2><h3 id="ğŸš€-åŠŸèƒ½ä¸€è§ˆ"><a href="#ğŸš€-åŠŸèƒ½ä¸€è§ˆ" class="headerlink" title="ğŸš€ åŠŸèƒ½ä¸€è§ˆ"></a>ğŸš€ åŠŸèƒ½ä¸€è§ˆ</h3><ul><li>å…¨æ–°ã€Œé¢åŒ…å±‘ã€å¯¼èˆªæ ï¼›</li><li>ä»¤ç‰Œå‡­è¯ç”± Cloudflare Workers è‡ªåŠ¨åˆ·æ–°ï¼Œå¹¶ä¿å­˜äºï¼ˆå…è´¹çš„ï¼‰å…¨å±€ KV å­˜å‚¨ä¸­ï¼›</li><li>ä½¿ç”¨ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3R1cmJvbGlua3MvdHVyYm9saW5rcw==" rel="noopener external nofollow noreferrer">TurbolinksÂ®</a> å®ç°è·¯ç”±æ‡’åŠ è½½ï¼›</li><li>æ”¯æŒç”±ä¸–çºªäº’è”è¿è¥çš„ OneDrive ç‰ˆæœ¬ï¼›</li><li>æ”¯æŒ SharePoint éƒ¨ç½²ï¼›</li></ul><h3 id="ğŸ—ƒï¸-ç›®å½•ç´¢å¼•æ˜¾ç¤º"><a href="#ğŸ—ƒï¸-ç›®å½•ç´¢å¼•æ˜¾ç¤º" class="headerlink" title="ğŸ—ƒï¸ ç›®å½•ç´¢å¼•æ˜¾ç¤º"></a>ğŸ—ƒï¸ ç›®å½•ç´¢å¼•æ˜¾ç¤º</h3><ul><li>å…¨æ–°æ”¯æŒè‡ªå®šä¹‰çš„è®¾è®¡é£æ ¼ï¼š<a href="themes/spencer.css">spencer.css</a>ï¼›</li><li>æ”¯æŒä½¿ç”¨ Emoji ä½œä¸ºæ–‡ä»¶å¤¹å›¾æ ‡ï¼ˆå¦‚æœæ–‡ä»¶å¤¹åç§°ç¬¬ä¸€ä½æ˜¯ Emoji åˆ™è‡ªåŠ¨å¼€å¯è¯¥åŠŸèƒ½ï¼‰ï¼›</li><li>æ¸²æŸ“ <code>README.md</code> å¦‚æœå½“å‰ç›®å½•ä¸‹åŒ…å«æ­¤æ–‡ä»¶ï¼Œä½¿ç”¨ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cy9naXRodWItbWFya2Rvd24tY3Nz" rel="noopener external nofollow noreferrer">github-markdown-css</a> æ¸²æŸ“æ ·å¼ï¼›</li><li>æ”¯æŒã€Œåˆ†é¡µã€ï¼Œæ²¡æœ‰ä¸€ä¸ªç›®å½•ä»…é™æ˜¾ç¤º 200 ä¸ªé¡¹ç›®çš„é™åˆ¶äº†ï¼</li></ul><h3 id="ğŸ“-æ–‡ä»¶åœ¨çº¿é¢„è§ˆ"><a href="#ğŸ“-æ–‡ä»¶åœ¨çº¿é¢„è§ˆ" class="headerlink" title="ğŸ“ æ–‡ä»¶åœ¨çº¿é¢„è§ˆ"></a>ğŸ“ æ–‡ä»¶åœ¨çº¿é¢„è§ˆ</h3><ul><li>æ ¹æ®æ–‡ä»¶ç±»å‹æ¸²æŸ“æ–‡ä»¶å›¾æ ‡ï¼Œå›¾æ ‡ä½¿ç”¨ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9mb250YXdlc29tZS5jb20v" rel="noopener external nofollow noreferrer">Font Awesome icons</a>ï¼›</li><li>æ”¯æŒé¢„è§ˆï¼š<ul><li>çº¯æ–‡æœ¬ï¼š<code>.txt</code>.</li><li>Markdown æ ¼å¼æ–‡æœ¬ï¼š<code>.md</code>, <code>.mdown</code>, <code>.markdown</code>.</li><li>å›¾ç‰‡ï¼ˆæ”¯æŒ Medium é£æ ¼çš„å›¾ç‰‡ç¼©æ”¾ï¼‰ï¼š<code>.png</code>, <code>.jpg</code>, and <code>.gif</code>.</li><li>ä»£ç é«˜äº®ï¼š<code>.js</code>, <code>.py</code>, <code>.c</code>, <code>.json</code>â€¦</li><li>PDFï¼ˆæ”¯æŒæ‡’åŠ è½½ã€åŠ è½½è¿›åº¦ã€Chrome å†…ç½® PDF é˜…è¯»å™¨ï¼‰ï¼š<code>.pdf</code>.</li><li>éŸ³ä¹ï¼š<code>.mp3</code>, <code>.aac</code>, <code>.wav</code>, <code>.oga</code>.</li><li>è§†é¢‘ï¼š<code>.mp4</code>, <code>.flv</code>, <code>.webm</code>, <code>.m3u8</code>.</li></ul></li></ul><h3 id="ğŸ”’-ç§æœ‰æ–‡ä»¶å¤¹"><a href="#ğŸ”’-ç§æœ‰æ–‡ä»¶å¤¹" class="headerlink" title="ğŸ”’ ç§æœ‰æ–‡ä»¶å¤¹"></a>ğŸ”’ ç§æœ‰æ–‡ä»¶å¤¹</h3><p>æˆ‘ä»¬å¯ä»¥ç»™æŸä¸ªç‰¹å®šçš„æ–‡ä»¶å¤¹ï¼ˆç›®å½•ï¼‰ä¸Šé”ï¼Œéœ€è¦è®¤è¯æ‰èƒ½è®¿é—®ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>src/auth/config.js</code> æ–‡ä»¶ä¸­å°†æˆ‘ä»¬æƒ³è¦è®¾ä¸ºç§æœ‰æ–‡ä»¶å¤¹çš„æ–‡ä»¶å¤¹åç§°å†™å…¥ <code>ENABLE_PATHS</code> åˆ—è¡¨ä¸­ï¼Œå¹¶å°† <code>AUTH_ENABLED</code> è®¾ç½®ä¸º <code>true</code> æ¥å¼€å¯è¿™ä¸€åŠŸèƒ½ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰è®¤è¯æ‰€ä½¿ç”¨çš„ç”¨æˆ·å <code>NAME</code> ä»¥åŠå¯†ç ï¼Œå…¶ä¸­è®¤è¯å¯†ç ä¿å­˜äº <code>AUTH_PASSWORD</code> ç¯å¢ƒå˜é‡ä¸­ï¼Œå¦‚æœéœ€è¦è¿™ä¸€åŠŸèƒ½ï¼Œåˆ™éœ€è¦ä½¿ç”¨ wrangler æ¥è®¾ç½®è¿™ä¸€ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">wrangler secret put AUTH_PASSWORD<br><span class="hljs-comment"># åœ¨è¿™é‡Œè¾“å…¥ä½ è‡ªå·±çš„è®¤è¯å¯†ç </span><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæ³¨æ„ï¼Œåˆ«ç•¥è¿‡ï¼ï¼ï¼å¾…ä¼šéƒ¨ç½²æäº¤é¢„è§ˆä¹‹å‰ä¸€å®šè¦è®¾ç½®ï¼Œæˆ–è€…æŒ‰ç…§ä¸‹é¢çš„æç¤ºå…³æ‰ã€‚ä¸ç„¶ä¼šæç¤º<code>Uncaught ReferenceError: AUTH_PASSWORD is not defined</code></p></blockquote><p>å¦‚æœä¸éœ€è¦å¼€å¯è¿™ä¸€åŠŸèƒ½ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥æ³¨é‡Šæ‰å®šä¹‰ <code>PASS</code> å˜é‡çš„é‚£ä¸€è¡Œï¼Œä½¿ç”¨ä¸‹ä¸€è¡Œå°† <code>PASS</code> è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²å³å¯ã€‚ï¼ˆå¦å¤–ä¹Ÿéœ€è¦å°† <code>AUTH_ENABLED</code> è®¾ç½®ä¸º <code>false</code>ã€‚ï¼‰æœ‰å…³ wrangler çš„ä½¿ç”¨ç»†èŠ‚ç­‰è¯¦ç»†å†…å®¹ï¼Œè¯·å‚è€ƒ <a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">æ¥ä¸‹æ¥çš„éƒ¨åˆ†æ®µè½</a>ã€‚</p><h3 id="â¬‡ï¸-ä»£ç†ä¸‹è½½æ–‡ä»¶-æ–‡ä»¶ç›´é“¾è®¿é—®-ç¼©ç•¥å›¾"><a href="#â¬‡ï¸-ä»£ç†ä¸‹è½½æ–‡ä»¶-æ–‡ä»¶ç›´é“¾è®¿é—®-ç¼©ç•¥å›¾" class="headerlink" title="â¬‡ï¸ ä»£ç†ä¸‹è½½æ–‡ä»¶ / æ–‡ä»¶ç›´é“¾è®¿é—® / ç¼©ç•¥å›¾"></a>â¬‡ï¸ ä»£ç†ä¸‹è½½æ–‡ä»¶ / æ–‡ä»¶ç›´é“¾è®¿é—® / ç¼©ç•¥å›¾</h3><ul><li>[å¯é€‰] Proxied downloadï¼ˆä»£ç†ä¸‹è½½æ–‡ä»¶ï¼‰ï¼š<code>?proxied</code> - ç»ç”± CloudFlare Workers ä¸‹è½½æ–‡ä»¶ã€‚è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼ˆ1ï¼‰<code>config/default.js</code> ä¸­çš„ <code>proxyDownload</code> ä¸º <code>true</code>ï¼Œä»¥åŠï¼ˆ2ï¼‰ä½¿ç”¨å‚æ•° <code>?proxied</code> è¯·æ±‚æ–‡ä»¶ï¼›</li><li>[å¯é€‰] Raw file downloadï¼ˆæ–‡ä»¶ç›´é“¾è®¿é—®ï¼‰ï¼š<code>?raw</code> - è¿”å›æ–‡ä»¶ç›´é“¾è€Œä¸æ˜¯é¢„è§ˆç•Œé¢ï¼›</li><li>ä¸¤ä¸ªå‚æ•°å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œå³ <code>?proxied&amp;raw</code> å’Œ <code>?raw&amp;proxied</code> å‡æœ‰æ•ˆã€‚</li></ul><h4 id="è¡¥å……ï¼Œç¼©ç•¥å›¾çš„è·å–æ–¹å¼"><a href="#è¡¥å……ï¼Œç¼©ç•¥å›¾çš„è·å–æ–¹å¼" class="headerlink" title="è¡¥å……ï¼Œç¼©ç•¥å›¾çš„è·å–æ–¹å¼"></a>è¡¥å……ï¼Œç¼©ç•¥å›¾çš„è·å–æ–¹å¼</h4><ul><li><p>[å¯é€‰] thumbnailï¼ˆç¼©ç•¥å›¾ï¼‰ï¼š<code>?thumbnail=medium</code> - è¿”å›å›¾ç‰‡ç¼©ç•¥å›¾ï¼›</p><p>å¯ç”¨çš„å–å€¼å‚è§ï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvb25lZHJpdmUvZGV2ZWxvcGVyL3Jlc3QtYXBpL2FwaS9kcml2ZWl0ZW1fbGlzdF90aHVtYm5haWxzP3ZpZXc9b2RzcC1ncmFwaC1vbmxpbmUjc2l6ZS1vcHRpb25z" rel="noopener external nofollow noreferrer">driveitem_list_thumbnails</a><br>æŸäº›ç¼©ç•¥å›¾é€‰é¡¹åœ¨éä¸ªäººç‰ˆOneDriveæ— æ³•ä½¿ç”¨ï¼š<a href="#%E5%A6%82%E6%9E%9C%E9%81%87%E5%88%B0%E5%9B%BE%E7%89%87%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E7%BC%A9%E7%95%A5%E5%9B%BE">å›¾ç‰‡æ— æ³•æ˜¾ç¤ºç¼©ç•¥å›¾</a></p></li></ul><p>æ˜¯çš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä½ å¯ä»¥å°†è¿™ä¸€é¡¹ç›®ç”¨æ¥æ­å»ºã€Œå›¾åºŠã€ï¼Œæˆ–è€…ç”¨äºæ­å»ºé™æ€æ–‡ä»¶éƒ¨ç½²æœåŠ¡ï¼Œæ¯”å¦‚ä¸‹é¢çš„å›¾ç‰‡é“¾æ¥ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#small 96px</span><br>https:<span class="hljs-regexp">//</span>wuyang.ws/***.jpg?proxied&amp;thumbnail=small<br><br><span class="hljs-comment">#medium 176px</span><br>https:<span class="hljs-regexp">//</span>wuyang.ws/***.jpg?proxied&amp;thumbnail=medium<br><br><span class="hljs-comment">#large 800px</span><br>https:<span class="hljs-regexp">//</span>wuyang.ws/***.jpg?proxied&amp;thumbnail=large<br></code></pre></td></tr></table></figure><p><img src="https://wuyang.ws/p/small/%E5%9B%BE%E7%89%87/%E5%A6%B9%E5%AD%90%E5%9B%BE/2017062317353_5796/%E5%86%99%E7%9C%9F-3/3%20(1).jpg" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload><br><img src="https://wuyang.ws/p/medium/%E5%9B%BE%E7%89%87/%E5%A6%B9%E5%AD%90%E5%9B%BE/2017062317353_5796/%E5%86%99%E7%9C%9F-3/3%20(1).jpg" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload><br><img src="https://wuyang.ws/p/large/%E5%9B%BE%E7%89%87/%E5%A6%B9%E5%AD%90%E5%9B%BE/2017062317353_5796/%E5%86%99%E7%9C%9F-3/3%20(1).jpg" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p><h2 id="éƒ¨ç½²æŒ‡å—"><a href="#éƒ¨ç½²æŒ‡å—" class="headerlink" title="éƒ¨ç½²æŒ‡å—"></a>éƒ¨ç½²æŒ‡å—</h2><p><em>åˆè‡­åˆé•¿çš„ä¸­æ–‡ç‰ˆéƒ¨ç½²æŒ‡å—é¢„è­¦ï¼</em></p><h3 id="ç”Ÿæˆ-OneDrive-API-ä»¤ç‰Œ"><a href="#ç”Ÿæˆ-OneDrive-API-ä»¤ç‰Œ" class="headerlink" title="ç”Ÿæˆ OneDrive API ä»¤ç‰Œ"></a>ç”Ÿæˆ OneDrive API ä»¤ç‰Œ</h3><ol><li><p>è®¿é—®æ­¤ URL åˆ›å»ºæ–°çš„ Blade appï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9wb3J0YWwuYXp1cmUuY29tLyNibGFkZS9NaWNyb3NvZnRfQUFEX1JlZ2lzdGVyZWRBcHBzL0FwcGxpY2F0aW9uc0xpc3RCbGFkZQ==" rel="noopener external nofollow noreferrer">Microsoft Azure App registrations</a>ï¼ˆæ™®é€šç‰ˆ OneDriveï¼‰æˆ– <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9wb3J0YWwuYXp1cmUuY24vI2JsYWRlL01pY3Jvc29mdF9BQURfUmVnaXN0ZXJlZEFwcHMvQXBwbGljYXRpb25zTGlzdEJsYWRl" rel="noopener external nofollow noreferrer">Microsoft Azure.cn App registrations</a>ï¼ˆOneDrive ä¸–çºªäº’è”ç‰ˆæœ¬ï¼‰ï¼Œ<strong>å»ºè®®å°†è¯­è¨€è®¾ç½®ä¸ºã€Œè‹±è¯­ã€ä»¥ä¿è¯ä»¥ä¸‹æ­¥éª¤ä¸­æåˆ°çš„æ¨¡å—å’ŒæŒ‰é’®çš„åç§°ä¸€è‡´</strong>ï¼š</p><ol><li>ä½¿ç”¨ä½ çš„ Microsoft è´¦æˆ·ç™»å½•ï¼Œé€‰æ‹© <code>New registration</code>ï¼›</li><li>åœ¨ <code>Name</code> å¤„è®¾ç½® Blade app çš„åç§°ï¼Œæ¯”å¦‚ <code>my-onedrive-cf-index</code>ï¼›</li><li>å°† <code>Supported account types</code> è®¾ç½®ä¸º <code>Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)</code>ã€‚OneDrive ä¸–çºªäº’è”ç”¨æˆ·è®¾ç½®ä¸ºï¼š<code>ä»»ä½•ç»„ç»‡ç›®å½•ï¼ˆä»»ä½• Azure AD ç›®å½• - å¤šç§Ÿæˆ·ï¼‰ä¸­çš„å¸æˆ·</code>ï¼›</li><li>å°† <code>Redirect URI (optional)</code> è®¾ç½®ä¸º <code>Web</code>ï¼ˆä¸‹æ‹‰é€‰é¡¹æ¡†ï¼‰ä»¥åŠ <code>https://localhost</code>ï¼ˆURL åœ°å€ï¼‰ï¼›</li><li>ç‚¹å‡» <code>Register</code>.</li></ol><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-1.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p></li><li><p>åœ¨ <code>Overview</code> é¢æ¿è·å–ä½ çš„ Application (client) ID - <code>client_id</code>ï¼š</p><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-2.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p></li><li><p>æ‰“å¼€ <code>Certificates &amp; secrets</code> é¢æ¿ï¼Œç‚¹å‡» <code>New client secret</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å«åš <code>client_secret</code> çš„ Client secretï¼Œå¹¶å°† <code>Expires</code> è®¾ç½®ä¸º <code>Never</code>ã€‚ç‚¹å‡» <code>Add</code> å¹¶å¤åˆ¶ <code>client_secret</code> çš„ <code>Value</code> å¹¶ä¿å­˜ä¸‹æ¥ <strong>ï¼ˆä»…æœ‰æ­¤ä¸€æ¬¡æœºä¼šï¼‰</strong>ï¼š</p><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-3.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p></li><li><p>æ‰“å¼€ <code>API permissions</code> é¢æ¿ï¼Œé€‰æ‹© <code>Microsoft Graph</code>ï¼Œé€‰æ‹© <code>Delegated permissions</code>ï¼Œå¹¶æœç´¢ <code>offline_access, Files.Read, Files.Read.All</code> è¿™ä¸‰ä¸ªæƒé™ï¼Œ<strong>é€‰æ‹©è¿™ä¸‰ä¸ªæƒé™ï¼Œå¹¶ç‚¹å‡» <code>Add permissions</code>ï¼š</strong></p><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-4.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p><p>ä½ åº”è¯¥æˆåŠŸå¼€å¯è¿™ä¸‰ä¸ªæƒé™ï¼š</p><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-5.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload></p></li><li><p>è·å– <code>refresh_token</code></p><ul><li><em>æœ¬åœ°è·å–</em> ï¼ˆéœ€è¦ Node.js å’Œ npm ç¯å¢ƒï¼Œå®‰è£…å’Œæ¨èé…ç½®è¯·å‚è€ƒ <a href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">å‡†å¤‡å·¥ä½œ</a>ï¼‰ä¸Šé¢æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">npx @beetcb/ms-graph-cli<br></code></pre></td></tr></table></figure><p><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-1.svg" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload><br>æ ¹æ®ä½ è‡ªå·±çš„æƒ…å†µé€‰æ‹©åˆé€‚çš„é€‰é¡¹ï¼Œå¹¶è¾“å…¥æˆ‘ä»¬ä¸Šé¢è·å–åˆ°çš„ä¸€ç³»åˆ— token ä»¤ç‰Œé…ç½®ç­‰ï¼Œå…¶ä¸­ <code>redirect_url</code> å¯ä»¥ç›´æ¥è®¾ç½®ä¸º <code>http://localhost</code>ã€‚æœ‰å…³å‘½ä»¤è¡Œå·¥å…·çš„å…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL2JlZXRjYi9tcy1ncmFwaC1jbGk=" rel="noopener external nofollow noreferrer">beetcb/ms-graph-cli</a>ã€‚</p><ul><li><em>åœ¨çº¿è·å–</em></li></ul><p>è®¿é—®ï¼š<a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9oZXltaW5kLmdpdGh1Yi5pby90b29scy9taWNyb3NvZnQtZ3JhcGgtYXBpLWF1dGg=" rel="noopener external nofollow noreferrer">Microsoft Graph API Auth</a> è·å–</p></li></ol><ol start="6"><li><p>æœ€åï¼Œåœ¨æˆ‘ä»¬çš„ OneDrive ä¸­åˆ›å»ºä¸€ä¸ªå…¬å…±åˆ†äº«æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ <code>/Public</code> å³å¯ã€‚<strong>å»ºè®®ä¸è¦ç›´æ¥åˆ†äº«æ ¹ç›®å½•!</strong></p><p>æœ€åï¼Œè¿™ä¹ˆæŠ˜è…¾å®Œï¼Œæˆ‘ä»¬åº”è¯¥æˆåŠŸæ‹¿åˆ°å¦‚ä¸‹çš„å‡ ä¸ªå‡­è¯ï¼š</p><ul><li><code>refresh_token</code></li><li><code>client_id</code></li><li><code>client_secret</code></li><li><code>redirect_uri</code></li><li><code>base</code>ï¼šé»˜è®¤ä¸º <code>/Public</code>ã€‚</li></ul><p><em>æ˜¯ï¼Œæˆ‘çŸ¥é“å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯è¿™æ˜¯å¾®è½¯ï¼Œå¤§å®¶ç†è§£ä¸€ä¸‹ã€‚ğŸ¤·ğŸ¼â€â™‚ï¸</em></p></li></ol><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>Fork å† clone æˆ–è€…ç›´æ¥ clone <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3NwZW5jZXJ3b29vL29uZWRyaXZlLWNmLWluZGV4" rel="noopener external nofollow noreferrer">onedrive-cf-index</a>ï¼Œå¹¶å®‰è£…ä¾èµ– Node.jsã€<code>npm</code> ä»¥åŠ <code>wrangler</code>ã€‚</p><p><em>å¼ºçƒˆå»ºè®®å¤§å®¶ä½¿ç”¨ Node version manager æ¯”å¦‚ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL3RqL24=" rel="noopener external nofollow noreferrer">n</a> æˆ–è€… <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL252bS1zaC9udm0=" rel="noopener external nofollow noreferrer">nvm</a> å®‰è£… Node.js å’Œ <code>npm</code>ï¼Œè¿™æ ·æˆ‘ä»¬å…¨å±€å®‰è£…çš„ <code>wrangler</code> å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ç”¨æˆ·ç›®å½•ä¸‹å®‰è£…ä¿å­˜é…ç½®æ–‡ä»¶äº†ï¼Œä¹Ÿå°±ä¸ä¼šé‡åˆ°å¥‡å¥‡æ€ªæ€ªçš„æƒé™é—®é¢˜äº†ã€‚</em></p><blockquote><p>ä»¥ä¸‹ç›´æ¥ç”¨npmå®‰è£…å¯èƒ½å¤±è´¥ï¼Œè¯·çœ‹<a href="#%E6%9C%AC%E8%8A%82%E5%8F%AF%E8%83%BD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å®‰è£… CloudFlare Workers å®˜æ–¹ç¼–è¯‘éƒ¨ç½²å·¥å…·</span><br>npm i @cloudflare/wrangler -g<br><br><span class="hljs-comment"># ä½¿ç”¨ npm å®‰è£…ä¾èµ–</span><br>npm install<br><br><span class="hljs-comment"># ä½¿ç”¨ wrangler ç™»å½• CloudFlare è´¦æˆ·</span><br>wrangler login<br><br><span class="hljs-comment"># ä½¿ç”¨è¿™ä¸€å‘½ä»¤æ£€æŸ¥è‡ªå·±çš„ç™»å½•çŠ¶æ€</span><br>wrangler <span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure><p>æ‰“å¼€ <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9kYXNoLmNsb3VkZmxhcmUuY29tL2xvZ2lu" rel="noopener external nofollow noreferrer">https://dash.cloudflare.com/login</a> ç™»å½• CloudFlareï¼Œé€‰æ‹©è‡ªå·±çš„åŸŸåï¼Œ<strong>å†å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°å³ä¾§æ å¤„æˆ‘ä»¬çš„ <code>account_id</code> ä»¥åŠ <code>zone_id</code> äº†ã€‚</strong> åŒæ—¶ï¼Œåœ¨ <code>Workers</code> -&gt; <code>Manage Workers</code> -&gt; <code>Create a Worker</code> å¤„åˆ›å»ºä¸€ä¸ª <strong>DRAFT</strong> workerã€‚</p><p>ä¿®æ”¹æˆ‘ä»¬çš„ <a href="wrangler.toml"><code>wrangler.toml</code></a>ï¼š</p><ul><li><code>name</code>ï¼šå°±æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ draft worker åç§°ï¼Œæˆ‘ä»¬çš„ Worker é»˜è®¤ä¼šå‘å¸ƒåˆ°è¿™ä¸€åŸŸåä¸‹ï¼š<code>&lt;name&gt;.&lt;worker_subdomain&gt;.workers.dev</code>ï¼›</li><li><code>account_id</code>ï¼šæˆ‘ä»¬çš„ Cloudflare Account IDï¼›</li><li><code>zone_id</code>ï¼šæˆ‘ä»¬çš„ Cloudflare Zone IDã€‚</li></ul><p>åˆ›å»ºå«åš <code>BUCKET</code> çš„ Cloudflare Workers KV bucketï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># åˆ›å»º KV bucket</span><br>wrangler kv:namespace create <span class="hljs-string">&quot;BUCKET&quot;</span><br><br><span class="hljs-comment"># ... æˆ–è€…ï¼Œåˆ›å»ºåŒ…æ‹¬é¢„è§ˆåŠŸèƒ½çš„ KV bucket</span><br>wrangler kv:namespace create <span class="hljs-string">&quot;BUCKET&quot;</span> --preview<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <a href="wrangler.toml"><code>wrangler.toml</code></a> é‡Œé¢çš„ <code>kv_namespaces</code>ï¼š</p><ul><li><code>kv_namespaces</code>ï¼šæˆ‘ä»¬çš„ Cloudflare KV namespaceï¼Œä»…éœ€æ›¿æ¢ <code>id</code> å’Œï¼ˆæˆ–è€…ï¼‰<code>preview_id</code> å³å¯ã€‚<em>å¦‚æœä¸éœ€è¦é¢„è§ˆåŠŸèƒ½ï¼Œé‚£ä¹ˆç§»é™¤ <code>preview_id</code> å³å¯ã€‚</em></li></ul><p>ä¿®æ”¹ <a href="src/config/default.js"><code>src/config/default.js</code></a>ï¼š</p><ul><li><code>client_id</code>ï¼šåˆšåˆšè·å–çš„ OneDrive <code>client_id</code>ï¼›</li><li><code>base</code>ï¼šä¹‹å‰åˆ›å»ºçš„ <code>base</code> ç›®å½•ï¼›</li><li>å¦‚æœä½ éƒ¨ç½²å¸¸è§„å›½é™…ç‰ˆ OneDriveï¼Œé‚£ä¹ˆå¿½ç•¥ä»¥ä¸‹æ­¥éª¤å³å¯ï¼›</li><li>å¦‚æœä½ éƒ¨ç½²çš„æ˜¯ç”±ä¸–çºªäº’è”è¿è¥çš„ä¸­å›½ç‰ˆ OneDriveï¼š<ul><li>ä¿®æ”¹ <code>type</code> ä¸‹çš„ <code>accountType</code> ä¸º <code>1</code>ï¼›</li><li>ä¿æŒ <code>driveType</code> ä¸å˜ï¼›</li></ul></li><li>å¦‚æœä½ éƒ¨ç½²çš„æ˜¯ SharePoint æœåŠ¡ï¼š<ul><li>ä¿æŒ <code>accountType</code> ä¸å˜ï¼›</li><li>ä¿®æ”¹ <code>driveType</code> ä¸‹çš„ <code>type</code> ä¸º <code>1</code>ï¼›</li><li>å¹¶æ ¹æ®ä½ çš„ SharePoint æœåŠ¡ä¿®æ”¹ <code>hostName</code> å’Œ <code>sitePath</code>ã€‚</li></ul></li></ul><p>ä½¿ç”¨ <code>wrangler</code> æ·»åŠ  Cloudflare Workers ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ·»åŠ æˆ‘ä»¬çš„ refresh_token å’Œ client_secret</span><br>wrangler secret put REFRESH_TOKEN<br><span class="hljs-comment"># ... å¹¶åœ¨è¿™é‡Œç²˜è´´æˆ‘ä»¬çš„ refresh_token</span><br><br>wrangler secret put CLIENT_SECRET<br><span class="hljs-comment"># ... å¹¶åœ¨è¿™é‡Œç²˜è´´æˆ‘ä»¬çš„ client_secret</span><br></code></pre></td></tr></table></figure><h4 id="æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜</h4><p>å¦‚æœä½ æ˜¯ç”¨æœ¬åœ°è·å–<code>refresh_token</code>çš„éœ€è¦ä¿®æ”¹<code>redirect_uri</code>ä¸º<code>http://localhost</code></p><p><code>npm i @cloudflare/wrangler -g</code> å‡ºé”™ <code>Error: EACCES: permission denied, access &#39;/usr/lib/node_modules&#39;</code><br>å®‰è£…<code>wrangler</code>çš„æ—¶å€™æƒé™ä¸è¶³ï¼Œå³ä½¿<code>sudo npm i @cloudflare/wrangler -g</code>ä¹Ÿä¼šå‡ºé”™<br>è¿™æ—¶å€™åªèƒ½ç»™å®ƒå®‰è£…åˆ°å½“å‰é¡¹ç›®äº†ã€‚</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-built_in">npm</span> install @cloudflare/wrangler --save<br></code></pre></td></tr></table></figure><p><em>æ³¨æ„ï¼Œå³ä½¿ä½¿ç”¨ <code>sudo npm install -g @cloudflare/wrangler --unsafe-perm=true --allow-root</code> åé¢ä¹Ÿä¼šä¸èƒ½æ­£å¸¸ä½¿ç”¨</em></p><h3 id="ç¼–è¯‘ä¸éƒ¨ç½²"><a href="#ç¼–è¯‘ä¸éƒ¨ç½²" class="headerlink" title="ç¼–è¯‘ä¸éƒ¨ç½²"></a>ç¼–è¯‘ä¸éƒ¨ç½²</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>wrangler</code> é¢„è§ˆéƒ¨ç½²ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wrangler preview<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæˆ‘ä»¬å³å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å‘å¸ƒ Cloudflare Workerï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">wrangler publish<br></code></pre></td></tr></table></figure><h4 id="æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜-1"><a href="#æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜-1" class="headerlink" title="æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>æœ¬èŠ‚å¯èƒ½é‡åˆ°çš„é—®é¢˜</h4><ul><li><p>é”™è¯¯å†…å®¹<code>getAccessToken</code><br>å¦‚æœä½ ç¡®å®šä¸Šé¢å¡«å†™çš„å†…å®¹éƒ½æ­£å¸¸ï¼Œé‚£ä¹ˆå¯èƒ½æ˜¯é‡åˆ°äº†<code>refresh_token</code>è¿‡é•¿<code>secret</code>ä¿å­˜å¤±è´¥â€¦â€¦</p><p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨KVæ¥ä¿å­˜<code>refresh_token</code></p><p>é¦–å…ˆè¿˜æ˜¯ä¸€æ ·çš„æ“ä½œï¼Œæ‹¿åˆ° refresh_token ä¹‹åï¼Œåœ¨ Cloudflare Workers â†’ KV é‡Œé¢çš„ BUCKET namespace ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ entry å°±å«åš refresh_tokenï¼Œç„¶åæŠŠä½ æ‹¿åˆ°çš„ refresh_token ç²˜è¿›å»ï¼š<br><img src="https://npm.elemecdn.com/nacdn@1.0.5/blog/files/2021/03/Cloudflare-Workers-OneDrive-6.png" srcset="https://npm.elemecdn.com/nacdn@1.0.21/blog/index/img/loading.svg" lazyload><br>ä¹‹åä¿®æ”¹ä»£ç ï¼Œåœ¨ <code>./src/auth/onedrive.js</code> é‡Œé¢åŠ ä¸€ä¸ªè·å– <code>refresh_token</code> çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// ...</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getAccessToken</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">timestamp</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() / <span class="hljs-number">1000</span>)<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> refresh_token = <span class="hljs-keyword">await</span> <span class="hljs-variable constant_">BUCKET</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;refresh_token&#x27;</span>)<br><br>  <span class="hljs-comment">// ä¹‹åæ‰€æœ‰çš„ config.refresh_token éƒ½ç›´æ¥æ”¹ä¸º refresh_token</span><br>  <span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é¡ºä¾¿è¿˜è¦æŠŠå…¶ä»–åŸæœ‰å®šä¹‰äº† <code>REFRESH_TOKEN</code> çš„åœ°æ–¹åˆ æ‰ï¼ˆæ¯”å¦‚ <code>./src/config/default.js</code> é‡Œé¢çš„ <code>refresh_token: REFRESH_TOKEN,</code> ä¸€è¡Œï¼‰ã€‚</p></li></ul><h2 id="æ ·å¼ã€å†…å®¹çš„è‡ªå®šä¹‰"><a href="#æ ·å¼ã€å†…å®¹çš„è‡ªå®šä¹‰" class="headerlink" title="æ ·å¼ã€å†…å®¹çš„è‡ªå®šä¹‰"></a>æ ·å¼ã€å†…å®¹çš„è‡ªå®šä¹‰</h2><ul><li>æˆ‘ä»¬ <strong>åº”è¯¥</strong> æ›´æ”¹é»˜è®¤ã€Œç€è½é¡µé¢ã€ï¼Œç›´æ¥ä¿®æ”¹ <code>src/folderView.js</code>#L51-L55) ä¸­ <code>intro</code> çš„ HTML å³å¯ï¼›</li><li>æˆ‘ä»¬ä¹Ÿ <strong>åº”è¯¥</strong> æ›´æ”¹é¡µé¢çš„ headerï¼Œç›´æ¥ä¿®æ”¹ <code>src/render/htmlWrapper.js</code>#L24 å³å¯ï¼›</li><li>æ ·å¼ CSS æ–‡ä»¶ä½äº <code>themes/spencer.css</code>ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦è‡ªå®šä¹‰æ­¤æ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦æ›´æ–° <code>src/render/htmlWrapper.js</code>#L3 æ–‡ä»¶ä¸­çš„ commit HASHï¼›</li><li>æˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰ Markdown æ¸²æŸ“ CSS æ ·å¼ã€PrismJS ä»£ç é«˜äº®æ ·å¼ï¼Œç­‰ç­‰ç­‰ã€‚</li></ul><h2 id="å¦‚æœé‡åˆ°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºç¼©ç•¥å›¾"><a href="#å¦‚æœé‡åˆ°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºç¼©ç•¥å›¾" class="headerlink" title="å¦‚æœé‡åˆ°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºç¼©ç•¥å›¾"></a>å¦‚æœé‡åˆ°å›¾ç‰‡æ— æ³•æ˜¾ç¤ºç¼©ç•¥å›¾</h2><blockquote><p>å¦‚æœä½¿ç”¨çš„ä¸æ˜¯ä¸ªäººç‰ˆOneDriveï¼Œä¸‹é¢å¸¦<code>Crop</code>çš„é€‰é¡¹å¯èƒ½æ— æ³•æ­£å¸¸æ˜¾ç¤ºç¼©ç•¥å›¾</p></blockquote><table><thead><tr><th align="left">Name</th><th align="left">Resolution</th><th align="left">Aspect Ratio</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>small</code></td><td align="left">96 longest</td><td align="left">Original</td><td align="left">Small, highly compressed thumbnail cropped to a square aspect ratio.</td></tr><tr><td align="left"><code>medium</code></td><td align="left">176 longest</td><td align="left">Original</td><td align="left">Cropped to the standard item size for the OneDrive web view.</td></tr><tr><td align="left"><code>large</code></td><td align="left">800 longest</td><td align="left">Original</td><td align="left">Thumbnail with the longest edge resized to 800 pixels.</td></tr><tr><td align="left"><del><code>smallSquare</code></del></td><td align="left">96x96</td><td align="left">Square Crop</td><td align="left"><strong>è¯¥é€‰é¡¹ä¸å¯ç”¨ï¼Œä¼šè¿”å›itemNotFoundé”™è¯¯</strong></td></tr><tr><td align="left"><del><code>mediumSquare</code></del></td><td align="left">176x176</td><td align="left">Square Crop</td><td align="left"><strong>è¯¥é€‰é¡¹ä¸å¯ç”¨ï¼Œä¼šè¿”å›itemNotFoundé”™è¯¯</strong></td></tr><tr><td align="left"><del><code>largeSquare</code></del></td><td align="left">800x800</td><td align="left">Square Crop</td><td align="left"><strong>è¯¥é€‰é¡¹ä¸å¯ç”¨ï¼Œä¼šè¿”å›itemNotFoundé”™è¯¯</strong></td></tr></tbody></table><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs http">https://wuyang.ws/***.jpg?proxied&amp;thumbnail=c300x400  #æ­£å¸¸<br>https://wuyang.ws/***.jpg?proxied&amp;thumbnail=c300x400_Crop  #ä¸å¯ç”¨<br></code></pre></td></tr></table></figure><hr><p>æœ€åï¼Œæ„Ÿè°¢ä½œè€… <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9ibG9nLnNwZW5jZXJ3b28uY29tLw==" rel="noopener external nofollow noreferrer">Spencer Woo</a>. ä¸ºæˆ‘ä»¬å¸¦æ¥å¦‚æ­¤å¼ºå¤§çš„ç¨‹åºï¼</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/c/notes/" class="category-chain-item">ä¸ªäººç¬”è®°</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tag/Cloudflare/">#Cloudflare</a> <a href="/tag/Workers/">#Workers</a> <a href="/tag/OneDrive/">#OneDrive</a> <a href="/tag/OneIndex-CF-Index/">#OneIndex-CF-Index</a> <a href="/tag/OneIndex/">#OneIndex</a></div></div><div class="license-box my-3"><div class="license-title"><div>ç”¨Cloudflare Workersæ­å»ºå…è´¹OneDriveç½‘ç›˜</div><div>https://cuojue.org/read/Cloudflare-Workers-OneDrive.html</div></div><div class="license-meta"><div class="license-meta-item"><div>ä½œè€…</div><div>WeiCN</div></div><div class="license-meta-item license-meta-date"><div>å‘å¸ƒäº</div><div>2021å¹´3æœˆ9æ—¥</div></div><div class="license-meta-item license-meta-date"><div>æ›´æ–°äº</div><div>2022å¹´3æœˆ13æ—¥</div></div><div class="license-meta-item"><div>è®¸å¯åè®®</div><div><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - ç½²å"><i class="iconfont icon-by"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - éå•†ä¸šæ€§ä½¿ç”¨"><i class="iconfont icon-nc"></i> </span></a><a target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - ç›¸åŒæ–¹å¼å…±äº«"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/read/backup-sh.html" title="ä¸€é”®å¤‡ä»½è„šæœ¬backup.sh(æ–°å¢æ”¯æŒCOS/é˜¿é‡Œäº‘ç›˜)"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">ä¸€é”®å¤‡ä»½è„šæœ¬backup.sh(æ–°å¢æ”¯æŒCOS/é˜¿é‡Œäº‘ç›˜)</span> <span class="visible-mobile">ä¸Šä¸€ç¯‡</span></a></article><article class="post-next col-6"><a href="/read/fix-hexo-fluid-theme-comments-and-images.html" title="è®°ä¸€æ¬¡ä½¿ç”¨PWA(ServiceWorker)åæ‡’åŠ è½½å¤±æ•ˆè§£å†³"><span class="hidden-mobile">è®°ä¸€æ¬¡ä½¿ç”¨PWA(ServiceWorker)åæ‡’åŠ è½½å¤±æ•ˆè§£å†³</span> <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="twikoo"></div><script type="text/javascript">Fluid.utils.loadComments("#comments",(function(){Fluid.utils.createScript("https://lib.baomitu.com/twikoo/1.5.0/twikoo.all.min.js",(function(){var o=Object.assign({envId:"blog-0g2mqd0q73214220",region:"ap-shanghai",path:"window.location.pathname"},{el:"#twikoo",path:"window.location.pathname",onCommentLoaded:function(){var o="#twikoo .tk-content img:not(.tk-owo-emotion)";Fluid.plugins.imageCaption(o),Fluid.plugins.fancyBox(o)}});twikoo.init(o)}))}))</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><div class="col-lg-7 mx-auto nopadding-x-md"><div class="container custom mx-auto"><style type="text/css">.tk-footer{visibility:hidden}.tk-icon{line-height:1%!important}</style></div></div></main><footer><div class="footer-inner"><div class="footer-content"><p style="font-size:small">&copy;&nbsp;2022 Copyright&nbsp; CuoJue&#39;s Blog Theme by <a target="_blank" href="https://cuojue.org/go/#aHR0cHM6Ly9naXRodWIuY29tL2ZsdWlkLWRldi9oZXhvLXRoZW1lLWZsdWlk" rel="noopener external nofollow noreferrer">Fluid</a></p></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/events.js"></script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?c987613129741480f7d9ce1f782ca4f3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.0/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init({tocSelector:"#toc-body",contentSelector:".markdown-body",headingSelector:CONFIG.toc.headingSelector||"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:CONFIG.toc.collapseDepth||0,scrollSmooth:!0,headingsOffset:-o}),t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))</script><script>!function(){var e=CONFIG.code_language.enable&&CONFIG.code_language.default,a=CONFIG.copy_btn;if(e||a){var i="";i+='<div class="code-widget">',i+="LANG",i+="</div>",jQuery(".markdown-body pre").each((function(){var n=jQuery(this);if(!(n.find("code.mermaid").length>0||n.find("span.line").length>0)){var t,c="";e&&(c=CONFIG.code_language.default,n[0].children.length>0&&n[0].children[0].classList.length>=2&&n.children().hasClass("hljs")?c=n[0].children[0].classList[1]:n[0].getAttribute("data-language")?c=n[0].getAttribute("data-language"):n.parent().hasClass("sourceCode")&&n[0].children.length>0&&n[0].children[0].classList.length>=2?(c=n[0].children[0].classList[1],n.parent().addClass("code-wrapper")):n.parent().hasClass("markdown-body")&&0===n[0].classList.length&&n.wrap('<div class="code-wrapper"></div>'),c=c.toUpperCase().replace("NONE",CONFIG.code_language.default)),n.append(i.replace("LANG",c).replace('code-widget">',(t=n[0],(Fluid.utils.getBackgroundLightness(t)>=0?"code-widget-light":"code-widget-dark")+(a?' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>':' code-widget">')))),a&&Fluid.utils.createScript("https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js",(function(){new window.ClipboardJS(".copy-btn",{target:function(e){for(var a=e.parentNode.childNodes,i=0;i<a.length;i++)if("CODE"===a[i].tagName)return a[i]}}).on("success",(function(e){e.clearSelection(),e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-copy","icon-success"),setTimeout((function(){e.trigger.innerHTML=e.trigger.innerHTML.replace("icon-success","icon-copy")}),2e3)}))}))}}))}}()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var o=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),n=[];for(var i of o)n.push(".markdown-body > "+i.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(n.join(", "))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/local-search.js"></script><script src="https://npm.elemecdn.com/nacdn@1.0.32/blog/js/custom.js"></script><script src="https://npm.elemecdn.com/nacdn@1.0.31/js/boot.js"></script><noscript><div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div></noscript></body></html>